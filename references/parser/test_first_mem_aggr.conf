##################################################################################
##################################################################################
## ~ test_simple_membership_aggregation_first_whitelist: 
#protocol IGMPv3; DO NOT USE!!! \n \
#pinstance pinst: u1 u2 u3 ==> d4 d5;
#interface index: 1  2  3 ==>  4  5
#interface prio:  1  2  3 ==> ... 

table tu1 {
    (239.99.99.99 | 4.4.4.4) #(a)
    (239.99.99.99 | 16.16.16.16) #(b)
};

table tu2 {
    u2 (239.99.99.99 | 5.5.5.5) #(a)
    (239.99.99.99 | 14.14.14.14) #(b)
    (239.99.99.99 | 15.15.15.15) #(b)
};

table tu3 {
#   (239.99.99.99 | 6.6.6.6) #a) block 6.6.6.6
    (239.99.99.99 | 17.17.17.17) #(b)
    (239.99.99.99 | 24.24.24.24) #(c)
};

table td4 {
    u1 (239.99.99.99 | 4.4.4.4) #(a)
    (239.99.99.99 | 14.14.14.14) #(b)
    (239.99.99.99 | 24.24.24.24) #(c)
    (239.99.99.99 | 25.25.25.25) #(c)
};

table td5 {
    u2 (239.99.99.99 | 5.5.5.5) #(a)
    (239.99.99.99 | 15.15.15.15) #(b)
};

table td6 {
   u3 (239.99.99.99 | 6.6.6.6) #(a)
    (239.99.99.99 | 16.16.16.16) #(b)
    (239.99.99.99 | 17.17.17.17) #(b)
};


pinstance pinst upstream * in rulematching first;

pinstance pinst upstream u1 in whitelist table tu1;
pinstance pinst upstream u2 in whitelist table tu2;
pinstance pinst upstream u3 in whitelist table tu3;

pinstance pinst downstream d4 out whitelist table td4;
pinstance pinst downstream d5 out whitelist table td5;
pinstance pinst downstream d6 out whitelist table td6;


Scenario: \n \
       (a)                    (b)                     (c) \n \
       +-----------------+    +-----------------+     +-----------------+ \n \
       | 1      2      3 |    | 1      2      3 |     | 1      2      3 | \n \
       | ^      ^      ^ |    | ^    ^ ^      ^ |     |              ^  | \n \
       | |      |      | |    | |   /  |      | |     |             / x | \n \
       | |      |      | |    | +--+---+----+ | |     |   ---------- /  | \n \
       | |      |      | |    |   /    |    | | |     |  / ----------   | \n \
       | 4      5      6 |    | 4      5      6 |     | 4      5      6 | \n \
       +-----------------+    +-----------------+     +-----------------+ \n \
Addr:    4      5      5       14     15    16/17     24/25 \n \
        in     in     in       in     in     in        in  \n \





##################################################################################
##################################################################################
## ~ test_simple_membership_aggregation_first_blacklist: 
#protocol IGMPv3; DO NOT USE!!! \n \
#pinstance pinst: u1 u2 u3 ==> d4 d5;
#interface index: 1  2  3 ==>  4  5
#interface prio:  1  2  3 ==> ... 

table tu1 {
    (239.99.99.70 - 239.99.99.110 | 5.5.5.5)  #(b)
    (239.99.99.99 | 6.6.6.6) #(b)
    (239.99.99.99 | 7.7.7.7) #(c)
    (239.99.99.99 | 8.8.8.8) #(d)
    (239.99.99.99 | 9.9.9.9) #(d)
    (239.99.99.99 | 10.10.10.10) #(d)
};

table tu2 {
    u2 (239.99.99.99 | 6.6.6.6) #(b)
#    (239.99.99.99 | 7.7.7.7) #(c) allready blocked in (a)
    (239.99.99.99 | 9.9.9.9) #(d)
};

table tu3 {
#    (239.99.99.99 | 9.9.9.9) #(d) allready blocked in (a)
};


table td4 {
    u2 ( * | * ) #(a)
};

table td5 {
    (239.99.99.99 | 10.10.10.10) #(d)
    
};

table td6 {
    u3 ( 239.99.99.0/24 | * ) #(a)
};

pinstance pinst upstream * in rulematching first;

pinstance pinst upstream u1 in blacklist table tu1;
pinstance pinst upstream u2 in blacklist table tu2;
pinstance pinst upstream u3 in blacklist table tu3;

pinstance pinst downstream d4 out blacklist table td4;
pinstance pinst downstream d5 out blacklist table td5;
pinstance pinst downstream d6 out blacklist table td6;





    # I think this is the result
    #UT_CHECK(gmem_u1.first == EXCLUDE_MODE); 
    #UT_CHECK(gmem_u1.second == (slist{addr("4.4.4.4"), addr("5.5.5.5"), addr("6.6.6.6"), addr("7.7.7.7"), addr("8.8.8.8"), addr("9.9.9.9"), addr("10.10.10.10")})); 
    

    #UT_CHECK(gmem_u2.first == INCLUDE_MODE); 
    #UT_CHECK(gmem_u2.second == (slist{addr("5.5.5.5"), addr("8.8.8.8")})); 


    #UT_CHECK(gmem_u3.first == INCLUDE_MODE); 
    #UT_CHECK(gmem_u3.second == (slist{addr("7.7.7.7")})); 
